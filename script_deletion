# Set execution policy for this session (optional)
Set-ExecutionPolicy Bypass -Scope Process -Force

# Profiles to exclude
$excludedProfiles = @('freshman', 'Default', 'Labz', 'Public')

# Show excluded profiles
Write-Output "Excluded profiles:"
$excludedProfiles

# Get all non-special local profiles
$profiles = Get-CimInstance Win32_UserProfile | Where-Object {
    -not $_.Special -and $_.LocalPath
}

foreach ($profile in $profiles) {
    $profileName = Split-Path $profile.LocalPath -Leaf
    if ($excludedProfiles -contains $profileName) { continue }
    $profile | Remove-CimInstance
}

Write-Output "Profile cleanup complete."
